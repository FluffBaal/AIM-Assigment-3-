import{j as e}from"./index-CvtPTGeu.js";import{b as t,u as s}from"./react-vendor-79u6xiU-.js";import{u as r,a}from"./api-lYTg9YvB.js";import"./axios-vendor-wEVgSxmm.js";const n=({isOpen:s,onClose:r,onSubmit:a})=>{const[n,o]=t.useState(""),[i,l]=t.useState("");t.useEffect(()=>{s&&(o(""),l(""))},[s]);return s?e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Enter OpenAI API Key"}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),n.trim()?n.startsWith("sk-")?a(n.trim()):l('Invalid API key format. OpenAI API keys start with "sk-"'):l("Please enter your API key")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"apiKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),e.jsx("input",{type:"password",id:"apiKey",value:n,onChange:e=>o(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"sk-...",autoFocus:!0}),i&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"Your API key is stored locally and never sent to our servers."}),e.jsxs("p",{className:"mt-1",children:["Get your API key from"," ",e.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-indigo-600 hover:text-indigo-500",children:"OpenAI Dashboard"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[r&&e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Save API Key"})]})]})]})}):null},o=({onFileUploaded:s})=>{const{apiKey:n}=r(),[o,i]=t.useState(!1),[l,d]=t.useState(!1),[c,m]=t.useState(null),[u,x]=t.useState(0),[p,g]=t.useState(null),[h,f]=t.useState(!1),y=t.useRef(null),v=e=>{return t=null,r=null,o=function*(){if(n)if("application/pdf"===e.type)if(e.size>10485760)m("File size must be less than 10MB");else{m(null),d(!0),x(0),g(e.name);try{const t=setInterval(()=>{x(e=>Math.min(e+10,90))},200),r=yield a.uploadPDF(e,n);clearInterval(t),x(100),setTimeout(()=>{d(!1),f(!0),g(e.name),s(r.file_id)},500)}catch(t){m(t instanceof Error?t.message:"Failed to upload file"),d(!1),x(0)}}else m("Please select a PDF file");else m("API key is required")},new Promise((e,s)=>{var a=e=>{try{i(o.next(e))}catch(t){s(t)}},n=e=>{try{i(o.throw(e))}catch(t){s(t)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(a,n);i((o=o.apply(t,r)).next())});var t,r,o};return e.jsxs("div",{className:"w-full",children:[h?e.jsxs("div",{className:"text-center p-8 bg-green-50 rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-green-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Upload successful!"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:[p," uploaded successfully"]}),e.jsx("button",{onClick:()=>{f(!1),g(null),m(null),x(0),y.current&&(y.current.value="")},className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Upload Another PDF"})]}):e.jsxs("div",{"data-testid":"drop-zone",onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),i(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),i(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),i(!1);const t=Array.from(e.dataTransfer.files).find(e=>"application/pdf"===e.type);t?v(t):m("Please select a PDF file")},onClick:()=>{var e;return null==(e=y.current)?void 0:e.click()},className:`\n            relative border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n            ${o?"border-indigo-600 bg-indigo-50":"border-gray-300 hover:border-gray-400"}\n            ${l?"pointer-events-none opacity-75":""}\n          `,children:[e.jsx("input",{ref:y,"data-testid":"file-input",type:"file",accept:".pdf",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&v(s)},className:"hidden",disabled:l}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-12 h-12 mx-auto animate-spin rounded-full border-4 border-gray-300 border-t-indigo-600"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Uploading..."}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Processing ",p||"file"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Upload PDF"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Drag and drop your PDF here or ",e.jsx("span",{className:"text-indigo-600 font-medium",children:"Browse Files"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"PDF files up to 10MB"})]})]}),c&&e.jsx("div",{className:"mt-2 text-sm text-red-600 text-center",children:c})]})},i=()=>{const a=s(),{apiKey:i,setApiKey:l}=r(),[d,c]=t.useState(!i);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Chat with your PDF documents"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Upload a PDF document and start asking questions. Our RAG system will find relevant information and provide accurate answers with source citations."})]}),i?e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx(o,{onFileUploaded:e=>{a(`/chat/${e}`)}}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>c(!0),className:"text-sm text-gray-500 hover:text-gray-700 underline",children:"Change API Key"})})]}):e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>c(!0),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Get Started"})}),e.jsx(n,{isOpen:d,onClose:()=>i&&c(!1),onSubmit:e=>{l(e),c(!1)}})]})};export{i as HomePage};
